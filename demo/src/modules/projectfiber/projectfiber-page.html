<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../elements/kct-view/kct-view.html">
<link rel="import" href="../../elements/kct-grid/kct-grid.html">
<link rel="import" href="../../elements/kct-ajax/kct-ajax.html">
<link rel="import" href="../../elements/kct-file/kct-file.html">
<link rel="import" href="../../elements/kct-message/kct-alert.html">
<link rel="import" href="../../elements/kct-message/kct-confirm.html">


<dom-module id="projectfiber-page">

	<template>

		<style include="theme-helper"></style>
		<style>
			:host {
                height: var(--datagrid-page-height, 582px);
            }
            #grid {
                height: 100%;
            }
		</style>

		<kct-ajax id="ajax"></kct-ajax>
		<kct-ajax id="ajax2"></kct-ajax>
		

		<kct-grid
			id = "grid"
			url = "{{url}}"
			params = "{{params}}"
			columns = "{{ columns }}"
			selection = "{{ selection }}"
			selected = "{{ selected }}"
            autoload>

			<div class="kct-grid-toolbar" slot="grid-toolbar">
				
				<paper-button class="paper-button-icon" on-tap="__onAddTap"><iron-icon icon="add"></iron-icon>New</paper-button>
                <paper-button class="paper-button-icon" on-tap="__onEditTap"><iron-icon icon="done"></iron-icon>Edit</paper-button>
                <paper-button class="paper-button-icon" on-tap="__onDeleteTap"><iron-icon icon="clear"></iron-icon>Delete</paper-button>
                <paper-button class="paper-button-icon" on-tap="__oncekdx"><iron-icon icon="clear"></iron-icon>Cek DX</paper-button>

			</div>

		</kct-grid>

		<kct-alert id="alert-empty">
			<p slot="message">
				No record(s) selected!
			</p>
		</kct-alert>

		<kct-confirm id="confirm-delete">
			<p slot="message">
				<template is="dom-if" if="[[ selected ]]">
                    Are you sure want to delete <b class="f-600">[[ selected.su_fullname ]]</b>    
                </template>
			</p>
		</kct-confirm>

		<paper-dialog id="popup-dialog">
			<paper-dialog-scrollable>
				<div class="p-a">
					<kct-file id="file"></kct-file>
					<paper-button on-tap="__onBrowseTap" class="btn-primary">UPLOAD XLS</paper-button>
					<paper-button on-tap="__onUploadTap" class="btn-primary">UPLOAD</paper-button>
				</div>
                
			  <br>
			  <div class="output"></div>
			</paper-dialog-scrollable>
		</paper-dialog>

	</template>

	<script>
		
		class ProjectPage extends KctView {

			static get is() {
				return 'projectfiber-page';
			}

			static get properties() {
				return {
					url: { type: String, value: '/project'},
					title: { type: String, notify: true, value: 'Project'},
                    params: { type: Object, value: {} },
                    selected: { type: Object },
                    selection: { type: Array },
                    columns: {
                        type: Array,
                        value: () => {
                            return [
                                { 
                                	type: 'rownumber' 
                                },
                                {
                                	text: 'Project ID',
                                	dataIndex: 'tp_project_id'
                                },
                                {
                                	text: 'Project Name',
                                	dataIndex: 'tp_project_name'
                                },
                                {
                                	text: 'POP ID',
                                	dataIndex: 'tp_pop_id'
                                },
                                {
                                	text: 'POP Name',
                                	dataIndex: 'tp_pop_name'
                                },
                                {
                                	text: 'Parent ID',
                                	dataIndex: 'tp_parent_id'
                                },
                                {
                                	text: 'Parent Type',
                                	dataIndex: 'tp_parent_type'
                                },
                                {
                                	text: 'Core Cable',
                                	dataIndex: 'tp_core_cable'
                                },
                                {
                                	text: 'Parent Status',
                                	dataIndex: 'tp_parent_status'
                                },
                                {
                                	text: 'Lokasi',
                                	dataIndex: 'tp_lokasi'
                                },
                                {
                                	text: 'Kota',
                                	dataIndex: 'tp_kota'
                                },
                                {
                                	text: 'Kecamatan',
                                	dataIndex: 'tp_kecamatan'
                                },
                                {
                                	text: 'Kelurahan',
                                	dataIndex: 'tp_kelurahan'
                                },
                                {
                                	text: 'Tinggi Tiang Ukuran HH',
                                	dataIndex: 'tp_tinggi_tiang_ukuran_hh'
                                },
                                {
                                	text: 'Latitude',
                                	dataIndex: 'tp_latitude'
                                },
                                {
                                	text: 'Longitude',
                                	dataIndex: 'tp_longitude'
                                },
                                {
                                	text: 'JB',
                                	dataIndex: 'tp_jb'
                                },
                                {
                                	text: 'Port JB',
                                	dataIndex: 'tp_port_jb'
                                },
                                {
                                	text: 'MS',
                                	dataIndex: 'tp_ms'
                                },
                                {
                                	text: 'MS Type',
                                	dataIndex: 'tp_ms_type'
                                },
                                {
                                	text: 'DPFO',
                                	dataIndex: 'tp_dpfo'
                                },
                                {
                                	text: 'Splitter',
                                	dataIndex: 'tp_splitter'
                                },
                                {
                                	text: 'Splitter Type',
                                	dataIndex: 'tp_splitter_type'
                                },
                                {
                                	text: 'Hanger Cable',
                                	dataIndex: 'tp_hanger_cable'
                                }
                            ];
                        }
                    }
				};
			}

			__onBrowseTap() {
				this.$.file.browse();
			}

			__onUploadTap() {
				this.$.ajax2.UPLOAD('/project/upload', {
					files: [
						{name: 'userfile', file: this.$.file.file()}
					]
				}).then((res) => {

					if(res.success) {
						this.$.grid.reload();
                        this.$['popup-dialog'].close();
						
					}
				})
			}

			__onAddTap() {
				this.$['popup-dialog'].open();
			}

			__oncekdx() {
				this.$.ajax.GET('/project/uploaddocument').then((res) => {
					if(res.success) {
						// this.$.ajax.GET('/datagrid', data).then((res) => {
		    //                 this.set('grid', res.data);
		    //             });
					}
				});
			}

			__btnSubmit() {
				console.log(this.$['tesform']);
				this.$['tesform'].submit();
			}
		}

		customElements.define(ProjectPage.is, ProjectPage);

	</script>
</dom-module>