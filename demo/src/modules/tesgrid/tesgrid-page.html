<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../bower_components/iron-ajax/iron-ajax.html">

<link rel="import" href="../../elements/kct-view/kct-view.html">
<link rel="import" href="../../elements/kct-grid/kct-grid.html">
<link rel="import" href="../../elements/kct-ajax/kct-ajax.html">
<link rel="import" href="../../elements/kct-file/kct-file.html">
<link rel="import" href="../../elements/kct-message/kct-alert.html">
<link rel="import" href="../../elements/kct-message/kct-confirm.html">

<dom-module id="tesgrid-page">

	<template>

		<style include="theme-helper"></style>
		<style>
			:host {
                height: var(--datagrid-page-height, 582px);
            }
            #grid {
                height: 100%;
            }
		</style>

		<kct-ajax id="ajax"></kct-ajax>
		<kct-ajax id="ajax2"></kct-ajax>
		

		<kct-grid
			id = "grid"
			url = "{{url}}"
			params = "{{params}}"
			columns = "{{ columns }}"
			selection = "{{ selection }}"
			selected = "{{ selected }}">

			<div class="kct-grid-toolbar" slot="grid-toolbar">
				
				<paper-button class="paper-button-icon" on-tap="__onAddTap"><iron-icon icon="add"></iron-icon>New</paper-button>
                <paper-button class="paper-button-icon" on-tap="__onEditTap"><iron-icon icon="done"></iron-icon>Edit</paper-button>
                <paper-button class="paper-button-icon" on-tap="__onDeleteTap"><iron-icon icon="clear"></iron-icon>Delete</paper-button>
                <paper-button class="paper-button-icon" on-tap="__oncekdx"><iron-icon icon="clear"></iron-icon>Cek DX</paper-button>

			</div>

		</kct-grid>

		<kct-alert id="alert-empty">
			<p slot="message">
				No record(s) selected!
			</p>
		</kct-alert>

		<kct-confirm id="confirm-delete">
			<p slot="message">
				<template is="dom-if" if="[[ selected ]]">
                    Are you sure want to delete <b class="f-600">[[ selected.su_fullname ]]</b>    
                </template>
			</p>
		</kct-confirm>

		<paper-dialog id="popup-dialog">
			<paper-dialog-scrollable>
				<div class="p-a">
					<kct-file id="file"></kct-file>
					<paper-button on-tap="__onBrowseTap" class="btn-primary">UPLOAD XLS</paper-button>
					<paper-button on-tap="__onUploadTap" class="btn-primary">UPLOAD</paper-button>

				</div>
				

				  <!-- <form id="tesform" action="/api/v2/demo/datagrid/debug/" method="post" enctype="multipart/form-data">

				  	<input type="file" name="userfile">

				    <br><br>
				    <paper-button raised on-tap="__btnSubmit">Submit</paper-button>
				    <paper-button raised onclick="__btnReset">Reset</paper-button>
				    <paper-button raised onclick="__btnValidate">Validate</paper-button>
				  </form> -->
				  <br>
				  <div class="output"></div>
			</paper-dialog-scrollable>
		</paper-dialog>

	</template>

	<script>
		
		class TesgridPage extends KctView {

			static get is() {
				return 'tesgrid-page';
			}

			static get properties() {
				return {
					url: { type: String, value: '/datagrid'},
					title: { type: String, notify: true, value: 'Tesgrid' },
                    params: { type: Object, value: {} },
                    selected: { type: Object },
                    selection: { type: Array },
                    columns: {
                        type: Array,
                        value: () => {
                            return [
                                { 
                                	type: 'rownumber' 
                                },
                                {
                                	text: 'Full Name',
                                	dataIndex: 'dg_fullname'
                                },
                                {
                                	text: 'Job',
                                	dataIndex: 'dg_job'
                                }
                            ];
                        }
                    }
				};
			}

			__onBrowseTap() {
				this.$.file.browse();
			}

			__onUploadTap() {
				this.$.ajax2.UPLOAD('/datagrid/upload', {
					files: [
						{name: 'userfile', file: this.$.file.file()}
					]
				}).then((res) => {

					if(res.success) {
						this.$.grid.__buildStore();
						// this.set('url',this.url + '?random='+1);
						// this.$.ajax.GET('/datagrid').then((res) => {
						// 	console.log('reload');
						// 	console.log('data', res.data);
						// 	this.$['popup-dialog'].close();
		    //                 this.set('grid', res.data);

		    //                 console.log(this.grid);
		    //             });
						
					}

					// console.log('res', res);
					// console.log(this.$['grid']);
				})
			}

			__onAddTap() {
				this.$['popup-dialog'].open();
			}

			__oncekdx() {
				this.$.ajax.GET('/datagrid/uploaddocument').then((res) => {
					if(res.success) {
						// this.$.ajax.GET('/datagrid', data).then((res) => {
		    //                 this.set('grid', res.data);
		    //             });
					}
				});
			}

			__btnSubmit() {
				console.log(this.$['tesform']);
				this.$['tesform'].submit();
			}
		}

		customElements.define(TesgridPage.is, TesgridPage);

	</script>
</dom-module>